applications:
  - name: external-secrets
    project: default
    source:
      repoURL: git@github.com:dolldot/manifests.git
      targetRevision: main
      path: components/external-secrets
    destination:
      server: https://kubernetes.default.svc
      namespace: external-secrets
    syncPolicy:
      automated:
        prune: true
        selfHeal: true
      syncOptions:
        - CreateNamespace=true
  - name: cert-manager
    project: default
    sources:
    - repoURL: git@github.com:dolldot/manifests.git
      targetRevision: main
      path: components/cert-manager
    - repoURL: git@github.com:dolldot/manifests.git
      targetRevision: main
      path: components/cert-manager/issuer/gts
    destination:
      name: clydev
      namespace: cert-manager
    syncPolicy:
      automated:
        prune: true
        selfHeal: true
      syncOptions:
        - CreateNamespace=true
applicationsets:
  - name: clydev
    generators:
      - matrix:
          generators:
            - list:
                elements:
                  - namespace: main
                  - namespace: ingress
            - git:
                repoURL: git@github.com:dolldot/manifests.git
                revision: main
                directories:
                  - path: "argocd/v1/clusters/clydev/{{namespace}}/*"
    template:
      metadata:
        name: "clydev-{{namespace}}-appset-{{path.basename}}"
      spec:
        project: default
        source:
          repoURL: git@github.com:dolldot/manifests.git
          targetRevision: main
          path: "{{path}}"
        destination:
          name: clydev
          namespace: "{{namespace}}"
        syncPolicy:
          automated:
            prune: true
            selfHeal: true
          syncOptions:
            - CreateNamespace=true
